#!/bin/bash

#MininetCodingSwitch workflow setup script.

#Run mininet in QEMU vm with rocker
#start qemu debian vm image
sudo nohup qemu-system-x86_64 /var/lib/libvirt/images/mininet.qcow2 \
-accel kvm \
-m size=6G \
-cpu host,+ssse3,+sse4.1,+sse4.2,+x2apic \
-smp 8 \
-numa node,cpus=0-3 \
-net nic -net user,hostfwd=tcp::10022-:22 \
-device e1000,id=eth1 \
-device e1000,id=eth2 \
-device e1000,id=eth3 \
-device e1000,id=eth4 \
-netdev tap,id=eth1,ifname=nic1 \
-netdev tap,id=eth2,ifname=nic2 \
-netdev tap,id=eth3,ifname=nic3 \
-netdev tap,id=eth4,ifname=nic4 \
-device rocker,id=sw1,name=sw1,len-ports=4,ports[0]=dev0,ports[1]=dev1,ports[2]=dev2,ports[3]=dev3 \
-netdev tap,id=dev0,ifname=tap0 \
-netdev tap,id=dev1,ifname=tap1 \
-netdev tap,id=dev2,ifname=tap2 \
-netdev tap,id=dev3,ifname=tap3 &>/dev/null &

#Backup mininet working to Dropbox folder periodically
while true
do
	sleep 600
	sudo sshpass -p 'maxandbella1' scp -P 10022 -r mininet@localhost:/home/mininet/* ~/Dropbox/Academics/MEng/Working/MininetCodingSwitch
done

